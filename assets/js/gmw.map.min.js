var GMW_Maps={},GMW_Map=function(e){var o=this,r=e.args.map_id,n=e.args,a=e.map_options,t=e.locations,s=e.user_position,m=(e.form,{id:r,map:!1,markers:[],user_position:!1,userMarker:!1,clusters:!1,spiderfier:!1,location_iw:!1,userInfoWindow:!1,bounds:new google.maps.LatLngBounds,infobox:null,currentMarker:null,autoZoomLevel:!1});this.init=function(){jQuery("#"+n.map_element).length&&jQuery(n.map_wrapper).slideDown("slow",function(){m.map?o.update_map():o.render_map()})},this.render_map=function(){"auto"==a.zoomLevel?(m.autoZoomLevel=!0,a.zoomLevel=13):(m.autoZoomLevel=!1,a.zoomLevel=parseInt(a.zoomLevel)),a.center=new google.maps.LatLng("40.758895","-73.985131"),a.mapTypeId=google.maps.MapTypeId[a.mapTypeId],m.map=new google.maps.Map(document.getElementById(n.map_element),a),google.maps.event.addListenerOnce(m.map,"idle",function(){jQuery("#gmw-map-loader-"+r).fadeOut(1e3),a.resizeMapControl&&0!=jQuery("#gmw-resize-map-toggle-"+r).length&&(m.resize_map_control=document.getElementById("gmw-resize-map-toggle-"+r),m.resize_map_control.style.position="absolute",m.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(m.resize_map_control),m.resize_map_control.style.display="block",jQuery("#gmw-resize-map-toggle-"+r).on("click",function(){var e=m.map.getCenter();jQuery(this).closest(".gmw-map-wrapper").toggleClass("gmw-expanded-map"),jQuery(this).toggleClass("gmw-icon-resize-full").toggleClass("gmw-icon-resize-small"),setTimeout(function(){google.maps.event.trigger(m.map,"resize"),m.map.setCenter(e)},100)})),o.clear_markers(),o.render_markers()})},this.update_map=function(){o.clear_markers(),o.render_markers()},this.clear_markers=function(){for(var e=0;e<m.markers.length+1;e++)e<m.markers.length?m.markers[e]&&m.markers[e].setMap(null):(m.markers=[],this.group_markers())},this.group_markers=function(){GMW.do_action("gmw_map_group_markers",n.group_markers,o);var e="group_"+n.group_markers;"function"==typeof o[e]?o[e](o):console.log("The function "+e+" not exists.")},this.group_normal=function(){},this.group_markers_clusterer=function(e){"function"==typeof MarkerClusterer&&(0!=m.clusters&&m.clusters.clearMarkers(),m.clusters=new MarkerClusterer(m.map,m.markers))},this.render_markers=function(){var e=t.length;for(i=0;i<e+1;i++)if(i<e){if(void 0==t[i].lat||void 0==t[i].lng||"0.000000"==t[i].lat||"0.000000"==t[i].lng)continue;var r=new google.maps.LatLng(t[i].lat,t[i].lng);m.bounds.extend(r),m.markers[i]=new google.maps.Marker({position:r,icon:t[i].map_icon,map:m.map,id:i}),"normal"==n.group_markers?(m.markers[i].setMap(m.map),google.maps.event.addListener(m.markers[i],"click",function(){o.marker_click(this)})):"markers_clusterer"==n.group_markers?(m.clusters.addMarker(m.markers[i]),google.maps.event.addListener(m.markers[i],"click",function(){o.marker_click(this)})):"markers_spiderfier"==n.group_markers&&(m.spiderfier.addMarker(m.markers[i]),m.markers[i].setMap(m.map)),GMW.do_action("gmw_map_single_marker",m.markers[i],o)}else o.user_position()},this.user_position=function(){0!=m.userMarker&&(m.userMarker.setMap(null),m.userMarker=!1,m.user_position=!1),s.lat&&s.lng&&"0"!=s.map_icon&&""!=s.map_icon?(m.user_position=new google.maps.LatLng(s.lat,s.lng),m.bounds.extend(m.user_position),m.userMarker=new google.maps.Marker({position:m.user_position,map:m.map,icon:s.map_icon}),0!=s.iw_content&&null!=s.iw_content&&(m.userInfoWindow=new google.maps.InfoWindow({content:s.iw_content}),1==s.iw_open&&m.userInfoWindow.open(m.map,m.userMarker),google.maps.event.addListener(m.userMarker,"click",function(){m.userInfoWindow.open(m.map,m.userMarker)})),o.center_map()):o.center_map()},this.center_map=function(){if(0==n.zoom_position||m.autoZoomLevel)1==t.length&&0==m.user_position?(m.autoZoomLevel?m.map.setZoom(13):m.map.setZoom(parseInt(a.zoomLevel)),m.map.panTo(m.markers[0].getPosition())):m.autoZoomLevel||0==m.user_position?(m.autoZoomLevel||0==m.user_position)&&m.map.fitBounds(m.bounds):(m.map.setZoom(parseInt(a.zoomLevel)),m.map.panTo(m.user_position));else{var e=new google.maps.LatLng(n.zoom_position.lat,n.zoom_position.lng);m.map.setZoom(parseInt(a.zoomLevel)),m.map.panTo(e)}},this.marker_click=function(e){m.currentMarker=e,"undefined"!=typeof directionsDisplay&&directionsDisplay.setMap(null),GMW.do_action("gmw_map_marker_click",e,o);var r="marker_click_"+n.info_window_type;"function"==typeof o[r]?o[r](e,o):console.log("The function "+r+" not exists.")},this.marker_click_normal=function(e){t[e.id].info_window_content&&(m.location_iw&&(m.location_iw.close(),m.location_iw=null),m.location_iw=new google.maps.InfoWindow({content:t[e.id].info_window_content,maxWidth:300}),m.location_iw.open(m.map,e))}};jQuery(document).ready(function(e){var o="undefined"!=typeof gmwMapObjects?gmwMapObjects:{};jQuery.each(o,function(e,o){GMW_Maps[e]=new GMW_Map(o),GMW_Maps[e].init()})});